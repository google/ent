#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o xtrace
set -o pipefail

export PROJECT=oak-ci
# export PROJECT=ent-store
export DOCKER_IMAGE=europe-docker.pkg.dev/$PROJECT/ent/ent-web:latest

export CGO_ENABLED=0

go build ./cmd/ent-web
docker build . --file=ent-web.Dockerfile --tag=$DOCKER_IMAGE
docker push $DOCKER_IMAGE
gcloud run deploy ent-web \
  --project=$PROJECT \
  --region=europe-west1 \
  --image=$DOCKER_IMAGE \
  --use-http2 \
  --allow-unauthenticated
